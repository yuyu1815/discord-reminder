{% extends "base.html" %}

{% block title %}Discord通知管理 - 通知追加{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center">
            <h2>新しい通知を追加</h2>
            <a href="{{ url_for('server_dashboard', server_id=server_id, token=token) }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> ダッシュボードに戻る
            </a>
        </div>
        <p class="text-muted">サーバーID: {{ server_id }}</p>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h3>通知設定フォーム</h3>
            </div>
            <div class="card-body">
                <form method="post" action="{{ url_for('add_notification', server_id=server_id, token=token) }}">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="option" class="form-label">通知タイプ <span class="text-danger">*</span></label>
                                <select class="form-select" id="option" name="option" required onchange="updateFormFields()">
                                    <option value="day">毎日</option>
                                    <option value="week">毎週</option>
                                    <option value="month">毎月</option>
                                    <option value="oneday">一回のみ</option>
                                </select>
                            </div>
                            
                            <div class="mb-3" id="weekField" style="display: none;">
                                <label for="week" class="form-label">曜日 <span class="text-danger">*</span></label>
                                <select class="form-select" id="week" name="week">
                                    <option value="monday">月曜日</option>
                                    <option value="tuesday">火曜日</option>
                                    <option value="wednesday">水曜日</option>
                                    <option value="thursday">木曜日</option>
                                    <option value="friday">金曜日</option>
                                    <option value="saturday">土曜日</option>
                                    <option value="sunday">日曜日</option>
                                </select>
                            </div>
                            
                            <div class="mb-3" id="dayField" style="display: none;">
                                <label for="day" class="form-label">日付 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="day" name="day" placeholder="月の場合: 1-31, 一回のみの場合: mm/dd (例: 12/25)">
                            </div>
                            
                            <div class="mb-3">
                                <label for="time" class="form-label">時間 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="time" name="time" placeholder="HH:MM:SS (例: 06:00:00)" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="channel_id" class="form-label">チャンネルID <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="channel_id" name="channel_id" placeholder="例: 123456789012345678" required>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="title" class="form-label">タイトル <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="title" name="title" placeholder="通知のタイトル" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="message" class="form-label">メッセージ <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="message" name="message" rows="3" placeholder="通知の本文" required></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="mention_ids" class="form-label">メンションするロールID</label>
                                <input type="text" class="form-control" id="mention_ids" name="mention_ids" placeholder="例: 123456789012345678">
                                <div class="form-text">空白の場合はメンションしません</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="img" class="form-label">画像URL</label>
                                <input type="text" class="form-control" id="img" name="img" placeholder="例: https://example.com/image.png">
                                <div class="form-text">空白の場合は画像を表示しません</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">通知を追加</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h3>ヘルプ</h3>
            </div>
            <div class="card-body">
                <h5>通知タイプについて</h5>
                <ul>
                    <li><strong>毎日</strong> - 毎日同じ時間に通知します</li>
                    <li><strong>毎週</strong> - 毎週特定の曜日に通知します</li>
                    <li><strong>毎月</strong> - 毎月特定の日または特定の週と曜日に通知します</li>
                    <li><strong>一回のみ</strong> - 指定した日時に一度だけ通知します</li>
                </ul>
                
                <h5>フィールドの説明</h5>
                <ul>
                    <li><strong>曜日</strong> - 毎週または毎月の通知で、どの曜日に通知するかを指定します</li>
                    <li><strong>日付</strong> - 毎月の通知では1-31の日付、一回のみの通知ではmm/dd形式の日付を指定します</li>
                    <li><strong>時間</strong> - HH:MM:SS形式で通知する時間を指定します</li>
                    <li><strong>チャンネルID</strong> - 通知を送信するDiscordチャンネルのIDを指定します</li>
                    <li><strong>タイトル</strong> - 通知のタイトルを指定します</li>
                    <li><strong>メッセージ</strong> - 通知の本文を指定します</li>
                    <li><strong>メンションするロールID</strong> - 通知時にメンションするロールのIDを指定します（オプション）</li>
                    <li><strong>画像URL</strong> - 通知に表示する画像のURLを指定します（オプション）</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock %}

{% block extra_js %}
<script>
    function updateFormFields() {
        const option = document.getElementById('option').value;
        const weekField = document.getElementById('weekField');
        const dayField = document.getElementById('dayField');
        
        // Hide all fields first
        weekField.style.display = 'none';
        dayField.style.display = 'none';
        
        // Show relevant fields based on option
        if (option === 'week') {
            weekField.style.display = 'block';
        } else if (option === 'month') {
            dayField.style.display = 'block';
            weekField.style.display = 'block';
        } else if (option === 'oneday') {
            dayField.style.display = 'block';
        }
    }
    
    // Initialize form fields on page load
    document.addEventListener('DOMContentLoaded', function() {
        updateFormFields();
    });
</script>
{% endblock %}